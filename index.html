<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lite TV Pro - Favorite Edition</title>
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        :root { --main: #ff0040; --bg: #050505; --fav: #ffc107; }
        body, html { margin: 0; padding: 0; background: var(--bg); color: #fff; font-family: sans-serif; overflow: hidden; height: 100%; }

        .video-box { width: 100%; height: 50vh; background: #000; position: relative; }
        video { width: 100%; height: 100%; outline: none; background: #000; }

        .list-area { height: 50vh; padding: 15px; overflow-y: auto; }
        .section-title { font-size: 16px; margin: 10px 0; color: var(--fav); font-weight: bold; }
        .grid { display: flex; overflow-x: auto; gap: 15px; padding-bottom: 15px; scroll-behavior: smooth; }
        .grid::-webkit-scrollbar { display: none; }

        .card { 
            background: #111; border-radius: 12px; padding: 10px; text-align: center;
            cursor: pointer; border: 2px solid transparent; outline: none; transition: 0.2s; min-width: 100px;
        }
        .card:focus { transform: scale(1.1); border-color: var(--main); background: #1a1a1a; }
        .card.is-fav { border-color: var(--fav); }

        .logo { width: 70px; height: 70px; background: #fff; border-radius: 50%; margin: 0 auto 8px; overflow: hidden; display: flex; align-items: center; justify-content: center; position: relative; }
        .logo img { width: 80%; height: auto; }
        .fav-star { position: absolute; top: 0; right: 0; color: var(--fav); font-size: 20px; display: none; }
        .card.is-fav .fav-star { display: block; }
        .name { font-size: 12px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; color: #ccc; }

        #msg { position: absolute; top: 20px; left: 20px; background: rgba(0,0,0,0.8); padding: 8px 15px; border-radius: 5px; display: none; border-left: 4px solid var(--main); font-weight: bold; z-index: 10; }
    </style>
</head>
<body>

    <div class="video-box">
        <div id="msg"></div>
        <video id="video" autoplay controls></video>
    </div>

    <div class="list-area">
        <div id="fav-section" style="display: none;">
            <div class="section-title">‚≠ê ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶™‡ßç‡¶∞‡¶ø‡ßü ‡¶ö‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶≤‡¶∏‡¶Æ‡ßÇ‡¶π</div>
            <div class="grid" id="fav-grid"></div>
        </div>
        
        <div class="section-title">üì∫ ‡¶∏‡¶ï‡¶≤ ‡¶ö‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶≤</div>
        <div class="grid" id="main-grid">
            <div style="padding: 20px;">‡¶Ö‡¶™‡ßá‡¶ï‡ßç‡¶∑‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®...</div>
        </div>
    </div>

    <script>
        const m3uUrl = 'https://raw.githubusercontent.com/soheltanver85-a11y/Live-tv2/refs/heads/main/Live-tv2';
        const video = document.getElementById('video');
        let channels = [];
        let favorites = JSON.parse(localStorage.getItem('tv_favs')) || [];
        let curIdx = 0;
        let pressTimer;

        function playStream(url) {
            if (Hls.isSupported()) {
                const hls = new Hls(); hls.loadSource(url); hls.attachMedia(video);
            } else { video.src = url; }
            video.play();
        }

        async function init() {
            try {
                const res = await fetch(m3uUrl);
                const data = await res.text();
                const lines = data.split('\n');
                let name = '', logo = '';
                lines.forEach(line => {
                    if (line.startsWith('#EXTINF')) {
                        name = (line.split(',')[1] || 'Unknown').trim();
                        logo = (line.match(/tvg-logo="(.*?)"/) || ["",""])[1];
                    } else if (line.startsWith('http')) {
                        channels.push({ name, logo, url: line.trim() });
                    }
                });
                renderAll();
                if(channels.length > 0) select(0);
            } catch (e) { showInfo("Internet Error!"); }
        }

        function renderAll() {
            renderGrid(channels, 'main-grid');
            renderFavs();
        }

        function renderGrid(list, targetId) {
            const container = document.getElementById(targetId);
            container.innerHTML = list.map((ch, i) => {
                const isFav = favorites.some(f => f.url === ch.url);
                return `
                <div class="card ${isFav ? 'is-fav' : ''}" tabindex="0" id="ch-${targetId}-${i}" 
                     onclick="selectByUrl('${ch.url}')" 
                     onmousedown="startPress('${ch.url}')" onmouseup="endPress()"
                     ontouchstart="startPress('${ch.url}')" ontouchend="endPress()">
                    <div class="logo">
                        <span class="fav-star">‚≠ê</span>
                        <img src="${ch.logo}" onerror="this.src='https://via.placeholder.com/100?text=TV'">
                    </div>
                    <div class="name">${ch.name}</div>
                </div>`;
            }).join('');
        }

        function renderFavs() {
            const sec = document.getElementById('fav-section');
            if (favorites.length > 0) {
                sec.style.display = 'block';
                renderGrid(favorites, 'fav-grid');
            } else { sec.style.display = 'none'; }
        }

        function startPress(url) {
            pressTimer = setTimeout(() => toggleFav(url), 1000); // ‡ßß ‡¶∏‡ßá‡¶ï‡ßá‡¶®‡ßç‡¶° ‡¶ß‡¶∞‡ßá ‡¶∞‡¶æ‡¶ñ‡¶≤‡ßá ‡¶´‡ßá‡¶≠‡¶æ‡¶∞‡¶ø‡¶ü ‡¶π‡¶¨‡ßá
        }
        function endPress() { clearTimeout(pressTimer); }

        function toggleFav(url) {
            const ch = channels.find(c => c.url === url);
            const index = favorites.findIndex(f => f.url === url);
            if (index > -1) {
                favorites.splice(index, 1);
                showInfo("‚≠ê ‡¶´‡ßá‡¶≠‡¶æ‡¶∞‡¶ø‡¶ü ‡¶•‡ßá‡¶ï‡ßá ‡¶¨‡¶æ‡¶¶ ‡¶¶‡ßá‡¶ì‡ßü‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá");
            } else {
                favorites.push(ch);
                showInfo("‚≠ê ‡¶´‡ßá‡¶≠‡¶æ‡¶∞‡¶ø‡¶ü‡ßá ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá");
            }
            localStorage.setItem('tv_favs', JSON.stringify(favorites));
            renderAll();
        }

        function selectByUrl(url) {
            const idx = channels.findIndex(c => c.url === url);
            if (idx > -1) select(idx);
        }

        function select(i) {
            if(i < 0) i = channels.length - 1;
            if(i >= channels.length) i = 0;
            curIdx = i;
            playStream(channels[i].url);
            showInfo("üì∫ " + channels[i].name);
        }

        function showInfo(txt) {
            const box = document.getElementById('msg');
            box.innerText = txt; box.style.display = 'block';
            clearTimeout(window.t); window.t = setTimeout(() => box.style.display = 'none', 3000);
        }

        document.addEventListener('keydown', (e) => {
            if (e.keyCode === 39) select(curIdx + 1);
            if (e.keyCode === 37) select(curIdx - 1);
            if (e.keyCode === 38) { video.volume = Math.min(video.volume + 0.1, 1); showInfo("üîä Volume: " + Math.round(video.volume * 100) + "%"); }
            if (e.keyCode === 40) { video.volume = Math.max(video.volume - 0.1, 0); showInfo("üîâ Volume: " + Math.round(video.volume * 100) + "%"); }
            if (e.keyCode === 13) { video.paused ? video.play() : video.pause(); }
        });

        init();
    </script>
</body>
</html>
