<!DOCTYPE html>
<html lang="bn">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Universal TV - Netflix/Tubi Style</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
<style>
:root{
--primary:#ff2a2a;
--bg:#050505;
--card:#1a1a1a;
--glass:rgba(255,255,255,.06);
--glow:0 0 20px rgba(255,42,42,.6);
--focus:#fff;
--text:#fff;
}

/* GENERAL */
*{margin:0;padding:0;box-sizing:border-box;font-family:'Inter',sans-serif;}
body,html{background:radial-gradient(circle at top,#111,#000 60%);color:var(--text);overflow-x:hidden;overflow-y:hidden;height:100%;font-size:16px;}
.app{display:flex;flex-direction:column;height:100vh;}

/* VIDEO */
.video-box{height:35vh;background:#000;position:relative;margin-bottom:10px;}
video{width:100%;height:100%;object-fit:contain;border-radius:8px;}
#loader{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);width:50px;height:50px;border:5px solid #eee;border-top:5px solid var(--primary);border-radius:50%;animation:spin 1s linear infinite;display:none;z-index:10;}
@keyframes spin{100%{transform:translate(-50%,-50%) rotate(360deg)}}
#now{position:absolute;bottom:14px;left:14px;background:rgba(0,0,0,.6);padding:8px 12px;border-radius:10px;font-weight:700;font-size:18px;}

/* SEARCH BAR */
.search-bar{padding:8px 12px;display:flex;gap:10px;align-items:center;}
.search-bar input{flex:1;padding:10px;border-radius:12px;border:none;background:#222;color:#fff;font-size:16px;outline:none;}

/* CATEGORY ROWS */
.category-row{margin:10px 0;display:flex;flex-direction:column;gap:6px;}
.category-row h2{margin-left:12px;font-size:18px;font-weight:700;}
.row-scroll{display:flex;overflow-x:auto;gap:12px;padding:0 12px;}
.row-scroll::-webkit-scrollbar{display:none;}
.card{min-width:120px;background:linear-gradient(180deg,#202020,#111);border-radius:12px;padding:8px;text-align:center;position:relative;cursor:pointer;transition:0.25s;}
.card img{width:100%;height:80px;object-fit:contain;border-radius:8px;margin-bottom:6px;}
.card span{font-size:14px;font-weight:600;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
.card:focus{transform:scale(1.1);box-shadow:0 0 15px var(--primary);border:2px solid var(--primary);z-index:10;}
.card .fav{position:absolute;top:6px;right:6px;font-size:18px;color:#ff0;display:none;}
.card.is-fav .fav{display:block;}

/* MOBILE ADJUST */
@media(max-width:768px){
.video-box{height:28vh;}
.card img{height:60px;}
.card span{font-size:13px;}
.category-row h2{font-size:16px;}
.search-bar input{font-size:14px;padding:8px;}
#now{font-size:14px;padding:4px 8px;}
}
</style>
</head>
<body>

<div class="app">
<!-- VIDEO -->
<div class="video-box" id="vbox" onclick="toggleFS()">
<div id="loader"></div>
<div id="now"></div>
<video id="player" autoplay playsinline webkit-playsinline></video>
</div>

<!-- SEARCH -->
<div class="search-bar">
<input type="text" id="searchInput" placeholder="চ্যানেল খুঁজুন..." oninput="search(this.value)">
</div>

<!-- CATEGORY CONTAINER -->
<div id="categoriesContainer"></div>

</div>

<script>
const M3U="https://raw.githubusercontent.com/soheltanver85-a11y/Live-tv2/main/Live-tv2";
const video=document.getElementById("player");
const loader=document.getElementById("loader");
const now=document.getElementById("now");
const categoriesContainer=document.getElementById("categoriesContainer");

let channels=[],filtered=[],favorites=JSON.parse(localStorage.getItem("tv_favs"))||[],current="",hls;

// INIT
async function init(){
try{
let res=await fetch(M3U);
let data=await res.text();
parseData(data);
}catch(e){console.log("Load Error",e);}
}

function parseData(data){
let lines=data.split("\n"),item={};
lines.forEach(l=>{
if(l.startsWith("#EXTINF")){
item.name=l.split(",")[1]||"TV";
item.logo=l.match(/tvg-logo="(.*?)"/)?.[1]||"https://via.placeholder.com/100";
item.group=l.match(/group-title="(.*?)"/)?.[1]||"All";
}else if(l.startsWith("http")){
item.url=l.trim();
channels.push({...item});
item={};
}
});
renderCategories();
let last=localStorage.getItem("last_tv");
if(last) play(last);
}

// RENDER CATEGORIES (Netflix/Tubi style)
function renderCategories(){
categoriesContainer.innerHTML="";
let groups=[...new Set(channels.map(c=>c.group))];
groups.forEach(g=>{
let groupChannels=channels.filter(c=>c.group===g);
let row=document.createElement("div");
row.className="category-row";
row.innerHTML=`<h2>${g}</h2>`;
let scroll=document.createElement("div");
scroll.className="row-scroll";
groupChannels.forEach(c=>{
let div=document.createElement("div");
div.className="card "+(favorites.includes(c.url)?"is-fav":"");
div.tabIndex=0;
div.innerHTML=`<img src="${c.logo}"><span>${c.name}</span><div class="fav">⭐</div>`;
div.onclick=()=>play(c.url);
div.oncontextmenu=(e)=>{e.preventDefault();toggleFav(c.url);};
scroll.appendChild(div);
});
row.appendChild(scroll);
categoriesContainer.appendChild(row);
});
filtered=[...channels];
}

// PLAY
function play(url){
current=url;
localStorage.setItem("last_tv",url);
loader.style.display="block";
let ch=channels.find(x=>x.url===url);
now.innerText=ch?.name||"";
if(hls) hls.destroy();
if(Hls.isSupported()){
hls=new Hls({lowLatencyMode:true});
hls.loadSource(url);
hls.attachMedia(video);
hls.on(Hls.Events.MANIFEST_PARSED,()=>video.play());
}else{
video.src=url; video.play();
}
video.onplaying=()=>loader.style.display="none";
}

// SEARCH
function search(q){
channels.forEach(c=>c.element?.parentNode?.removeChild(c.element));
filtered=channels.filter(c=>c.name.toLowerCase().includes(q.toLowerCase()));
renderCategories();
}

// FAVORITES
function toggleFav(url){
if(favorites.includes(url)) favorites=favorites.filter(x=>x!==url);
else favorites.push(url);
localStorage.setItem("tv_favs",JSON.stringify(favorites));
renderCategories();
}

// FULLSCREEN
function toggleFS(){
!document.fullscreenElement?
document.getElementById("vbox").requestFullscreen():
document.exitFullscreen();
}

// MOBILE PULL-DOWN REFRESH (simple)
let touchStartY=0;
document.addEventListener('touchstart',e=>{touchStartY=e.touches[0].clientY;});
document.addEventListener('touchend',e=>{
let touchEndY=e.changedTouches[0].clientY;
if(touchEndY - touchStartY > 50){renderCategories();}
});

init();
</script>

</body>
</html>
