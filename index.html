<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Premium TV - Favorite System</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        :root {
            --primary: #ff3e3e;
            --bg: #0a0a0a;
            --card-bg: #1a1a1a;
            --text: #ffffff;
        }

        body { background: var(--bg); color: var(--text); font-family: 'Inter', sans-serif; margin: 0; }

        /* Video Section */
        .video-container { width: 100%; position: sticky; top: 0; z-index: 100; background: #000; border-bottom: 2px solid var(--primary); }
        video { width: 100%; aspect-ratio: 16/9; display: block; }

        /* Actions */
        .action-buttons { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; padding: 15px; }
        .btn { padding: 12px; border-radius: 25px; border: none; font-weight: 700; color: white; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 8px; }
        .btn-mobile { background: linear-gradient(90deg, #ff416c, #ff4b2b); }
        .btn-tv { background: linear-gradient(90deg, #1d976c, #93f9b9); color: #000; }

        /* Grid & Cards */
        .channel-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; padding: 15px; }
        .channel-card { background: var(--card-bg); border-radius: 15px; position: relative; overflow: hidden; transition: 0.3s; border: 1px solid #222; }
        
        .logo-box { height: 90px; background: #fff; display: flex; align-items: center; justify-content: center; padding: 10px; cursor: pointer; }
        .logo-box img { max-height: 100%; max-width: 100%; object-fit: contain; }
        
        .info { padding: 10px; text-align: center; font-size: 14px; font-weight: 600; cursor: pointer; }

        /* Heart / Favorite Button */
        .fav-heart {
            position: absolute;
            top: 8px;
            right: 8px;
            width: 35px;
            height: 35px;
            background: rgba(0,0,0,0.4);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            z-index: 10;
            transition: 0.3s;
            backdrop-filter: blur(5px);
        }

        .fav-heart svg {
            width: 20px;
            height: 20px;
            fill: rgba(255,255,255,0.5); /* Default color (Gray/White) */
            transition: 0.3s;
            stroke: white;
            stroke-width: 2px;
        }

        /* ‡¶Ø‡¶ñ‡¶® ‡¶´‡ßá‡¶≠‡¶æ‡¶∞‡¶ø‡¶ü ‡¶π‡¶¨‡ßá (Active State) */
        .channel-card.is-fav .fav-heart svg {
            fill: #ff3e3e; /* ‡¶≤‡¶æ‡¶≤ ‡¶∞‡¶ô */
            stroke: #ff3e3e;
            filter: drop-shadow(0 0 5px rgba(255,62,62,0.8)); /* ‡¶â‡¶ú‡ßç‡¶ú‡ßç‡¶¨‡¶≤ ‡¶á‡¶´‡ßá‡¶ï‡ßç‡¶ü */
        }
        
        .channel-card.is-fav .fav-heart {
            background: rgba(255,255,255,0.15);
        }

        @media (min-width: 768px) { .channel-grid { grid-template-columns: repeat(4, 1fr); } }
    </style>
</head>
<body>

<div class="video-container">
    <video id="player" controls autoplay playsinline></video>
</div>

<div class="action-buttons">
    <button class="btn btn-mobile">üì± Mobile App</button>
    <button class="btn btn-tv">üì∫ TV App</button>
</div>

<div class="channel-grid" id="channelGrid">
    </div>

<script>
const M3U_URL = "https://raw.githubusercontent.com/soheltanver85-a11y/Live-tv2/main/Live-tv2";
const video = document.getElementById("player");
const channelGrid = document.getElementById("channelGrid");

// LocalStorage ‡¶•‡ßá‡¶ï‡ßá ‡¶´‡ßá‡¶≠‡¶æ‡¶∞‡¶ø‡¶ü ‡¶≤‡¶ø‡¶∏‡ßç‡¶ü ‡¶Ü‡¶®‡¶æ
let favorites = JSON.parse(localStorage.getItem("my_fav_channels")) || [];
let allChannels = [];

async function loadChannels() {
    try {
        const res = await fetch(M3U_URL);
        const data = await res.text();
        parseM3U(data);
    } catch (e) { console.error("Error", e); }
}

function parseM3U(data) {
    const lines = data.split('\n');
    let item = {};
    lines.forEach(line => {
        if (line.startsWith('#EXTINF')) {
            item.name = line.split(',')[1] || "TV Channel";
            item.logo = line.match(/tvg-logo="(.*?)"/)?.[1] || "https://via.placeholder.com/100";
        } else if (line.startsWith('http')) {
            item.url = line.trim();
            allChannels.push({...item});
            item = {};
        }
    });
    renderChannels();
}

function renderChannels() {
    channelGrid.innerHTML = allChannels.map(ch => {
        const isFav = favorites.includes(ch.url) ? 'is-fav' : '';
        return `
            <div class="channel-card ${isFav}" data-url="${ch.url}">
                <div class="fav-heart" onclick="toggleFavorite(event, '${ch.url}')">
                    <svg viewBox="0 0 24 24"><path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/></svg>
                </div>
                <div class="logo-box" onclick="playChannel('${ch.url}')">
                    <img src="${ch.logo}" alt="">
                </div>
                <div class="info" onclick="playChannel('${ch.url}')">${ch.name}</div>
            </div>
        `;
    }).join('');
}

function toggleFavorite(event, url) {
    event.stopPropagation(); // ‡¶Ø‡¶æ‡¶§‡ßá ‡¶ï‡¶æ‡¶∞‡ßç‡¶°‡ßá ‡¶ï‡ßç‡¶≤‡¶ø‡¶ï ‡¶≤‡ßá‡¶ó‡ßá ‡¶≠‡¶ø‡¶°‡¶ø‡¶ì ‡¶™‡ßç‡¶≤‡ßá ‡¶®‡¶æ ‡¶π‡ßü‡ßá ‡¶Ø‡¶æ‡ßü
    const card = event.currentTarget.closest('.channel-card');
    
    if (favorites.includes(url)) {
        favorites = favorites.filter(u => u !== url); // ‡¶∞‡¶ø‡¶Æ‡ßÅ‡¶≠
        card.classList.remove('is-fav');
    } else {
        favorites.push(url); // ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°
        card.classList.add('is-fav');
    }
    
    localStorage.setItem("my_fav_channels", JSON.stringify(favorites));
}

function playChannel(url) {
    if (Hls.isSupported()) {
        const hls = new Hls();
        hls.loadSource(url);
        hls.attachMedia(video);
        hls.on(Hls.Events.MANIFEST_PARSED, () => video.play());
    } else {
        video.src = url;
        video.play();
    }
    window.scrollTo({top: 0, behavior: 'smooth'});
}

loadChannels();
</script>

</body>
</html>
