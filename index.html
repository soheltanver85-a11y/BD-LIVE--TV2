<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Universal Premium TV</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        :root {
            --primary: #e50914; /* Netflix Red */
            --bg: #050505;
            --glass: rgba(255, 255, 255, 0.05);
            --text: #ffffff;
        }

        body {
            background-color: var(--bg);
            color: var(--text);
            font-family: 'Poppins', sans-serif;
            margin: 0;
            overflow-x: hidden;
        }

        /* ১. ভিডিও প্লেয়ার - আধুনিক গ্লাস ইফেক্ট */
        .video-wrapper {
            width: 100%;
            position: sticky;
            top: 0;
            z-index: 1000;
            background: rgba(0,0,0,0.85);
            backdrop-filter: blur(10px);
            border-bottom: 2px solid var(--primary);
        }
        video { width: 100%; aspect-ratio: 16/9; display: block; }

        .content { padding: 15px; }

        /* ২. আধুনিক সার্চ বার */
        .search-container {
            background: var(--glass);
            border-radius: 30px;
            padding: 5px 20px;
            display: flex;
            align-items: center;
            border: 1px solid rgba(255,255,255,0.1);
            margin-bottom: 20px;
        }
        .search-container input {
            background: transparent;
            border: none;
            color: white;
            padding: 12px;
            width: 100%;
            outline: none;
            font-size: 15px;
        }

        /* ৩. রিসেন্টলি প্লেড সেকশন */
        #recent-section { margin-bottom: 20px; display: none; }
        .section-title { font-size: 18px; font-weight: 700; margin-bottom: 12px; color: var(--primary); }

        /* ৪. ক্যাটাগরি পিলস - আধুনিক লুক */
        .nav-scroller {
            display: flex;
            gap: 12px;
            overflow-x: auto;
            padding-bottom: 15px;
            scrollbar-width: none;
        }
        .nav-pill {
            padding: 10px 25px;
            background: var(--glass);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 25px;
            white-space: nowrap;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            transition: 0.3s;
        }
        .nav-pill.active { background: var(--primary); color: white; border-color: var(--primary); box-shadow: 0 0 15px rgba(229, 9, 20, 0.4); }

        /* ৫. চ্যানেল গ্রিড এবং কার্ড */
        .grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; }
        .card {
            background: var(--glass);
            border-radius: 20px;
            overflow: hidden;
            border: 1px solid rgba(255,255,255,0.1);
            transition: 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            position: relative;
        }
        .card:hover { transform: translateY(-8px) scale(1.02); border-color: var(--primary); }
        
        .logo-box { height: 110px; background: white; padding: 15px; display: flex; align-items: center; justify-content: center; }
        .logo-box img { max-width: 100%; max-height: 100%; object-fit: contain; }

        .name-box { padding: 12px; text-align: center; font-size: 13px; font-weight: 600; }

        /* ফেভারিট হার্ট */
        .fav-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(0,0,0,0.5);
            width: 35px;
            height: 35px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(5px);
        }
        .card.is-fav .fav-btn svg { fill: var(--primary); }

        @media (min-width: 768px) { .grid { grid-template-columns: repeat(5, 1fr); } }
    </style>
</head>
<body>

<div class="video-wrapper">
    <video id="mainPlayer" controls autoplay playsinline></video>
</div>

<div class="content">
    <div id="recent-section">
        <div class="section-title">Recently Played</div>
        <div class="nav-scroller" id="recentContainer"></div>
    </div>

    <div class="search-container">
        <input type="text" placeholder="Search for channels, movies..." oninput="doSearch(this.value)">
    </div>

    <div class="nav-scroller" id="catNav">
        <div class="nav-pill active" onclick="filterData('ALL', this)">All Channels</div>
        <div class="nav-pill" onclick="filterData('FAVORITE', this)">Favorites</div>
        <div class="nav-pill" onclick="filterData('SPORTS', this)">Sports</div>
        <div class="nav-pill" onclick="filterData('BANGLA', this)">Bangla</div>
    </div>

    <div class="grid" id="mainGrid"></div>
</div>

<script>
    const M3U = "https://raw.githubusercontent.com/soheltanver85-a11y/Live-tv2/main/Live-tv2";
    let allData = [], favorites = JSON.parse(localStorage.getItem('fav_v2')) || [];
    let recents = JSON.parse(localStorage.getItem('recent_v2')) || [];

    async function loadData() {
        const res = await fetch(M3U);
        const text = await res.text();
        const lines = text.split('\n');
        let obj = {};
        lines.forEach(l => {
            if(l.startsWith('#EXTINF')) {
                obj.name = l.split(',')[1]?.trim();
                obj.logo = l.match(/tvg-logo="(.*?)"/)?.[1];
                obj.group = l.match(/group-title="(.*?)"/)?.[1];
            } else if(l.startsWith('http')) {
                obj.url = l.trim();
                allData.push({...obj});
                obj = {};
            }
        });
        renderGrid(allData);
        renderRecents();
    }

    function renderGrid(data) {
        const grid = document.getElementById('mainGrid');
        grid.innerHTML = data.map(ch => `
            <div class="card ${favorites.includes(ch.url) ? 'is-fav' : ''}">
                <div class="fav-btn" onclick="toggleFav(event, '${ch.url}')">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="white"><path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/></svg>
                </div>
                <div onclick="playChannel('${ch.url}', '${ch.name}')">
                    <div class="logo-box"><img src="${ch.logo}" onerror="this.src='https://via.placeholder.com/100'"></div>
                    <div class="name-box">${ch.name}</div>
                </div>
            </div>
        `).join('');
    }

    function playChannel(url, name) {
        const video = document.getElementById('mainPlayer');
        if (Hls.isSupported()) {
            const hls = new Hls();
            hls.loadSource(url);
            hls.attachMedia(video);
            hls.on(Hls.Events.MANIFEST_PARSED, () => video.play());
        } else { video.src = url; video.play(); }

        // রিসেন্টলি প্লেড এ অ্যাড করা
        if(!recents.includes(url)) {
            recents.unshift(url);
            if(recents.length > 10) recents.pop();
            localStorage.setItem('recent_v2', JSON.stringify(recents));
            renderRecents();
        }
        window.scrollTo({top: 0, behavior: 'smooth'});
    }

    function renderRecents() {
        const container = document.getElementById('recentContainer');
        const section = document.getElementById('recent-section');
        if(recents.length === 0) return;
        section.style.display = 'block';
        
        const recentChannels = allData.filter(c => recents.includes(c.url));
        container.innerHTML = recentChannels.map(ch => `
            <div class="nav-pill" onclick="playChannel('${ch.url}', '${ch.name}')">${ch.name}</div>
        `).join('');
    }

    function toggleFav(e, url) {
        e.stopPropagation();
        if(favorites.includes(url)) favorites = favorites.filter(u => u !== url);
        else favorites.push(url);
        localStorage.setItem('fav_v2', JSON.stringify(favorites));
        renderGrid(allData);
    }

    function filterData(type, el) {
        document.querySelectorAll('.nav-pill').forEach(b => b.classList.remove('active'));
        el.classList.add('active');
        if(type === 'ALL') renderGrid(allData);
        else if(type === 'FAVORITE') renderGrid(allData.filter(c => favorites.includes(c.url)));
        else renderGrid(allData.filter(c => (c.group+c.name).toUpperCase().includes(type)));
    }

    function doSearch(q) {
        const filtered = allData.filter(c => c.name.toLowerCase().includes(q.toLowerCase()));
        renderGrid(filtered);
    }

    loadData();
</script>
</body>
</html>
